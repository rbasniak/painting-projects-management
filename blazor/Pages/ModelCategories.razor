@page "/model-categories"
@using PaintingProjectsManagement.Blazor.Models
@using PaintingProjectsManagement.Blazor.Services
@inject IApiService ApiService

<PageTitle>Model Categories - Painting Projects Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudText Typo="Typo.h4" Class="mb-4">Model Categories</MudText>
    
    <MudPaper Class="pa-4">
        <MudToolBar>
            <MudText Typo="Typo.h6">All Model Categories</MudText>
            <MudSpacer />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="OpenAddDialog">
                Add Category
            </MudButton>
        </MudToolBar>
        
        <MudTable Items="@FilteredModelCategories" Dense="true" Hover="true" Striped="true" Loading="@_loading">
            <ToolBarContent>
                <MudTextField @bind-Value="_searchString" Placeholder="Search" 
                             Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" 
                             IconSize="Size.Medium" Class="mt-0"></MudTextField>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Name">@context.Name</MudTd>
                <MudTd DataLabel="Actions">
                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" OnClick="@(() => EditCategory(context))" />
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" OnClick="@(() => DeleteCategory(context))" />
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudPaper>
</MudContainer>

@code {
    private List<ModelCategory> ModelCategoriesList { get; set; } = new();
    private bool _loading = true;
    private string _searchString = "";

    private IEnumerable<ModelCategory> FilteredModelCategories => ModelCategoriesList.Where(category =>
        string.IsNullOrWhiteSpace(_searchString) ||
        category.Name.Contains(_searchString, StringComparison.OrdinalIgnoreCase));

    protected override async Task OnInitializedAsync()
    {
        await LoadModelCategories();
    }

    private async Task LoadModelCategories()
    {
        _loading = true;
        try
        {
            ModelCategoriesList = await ApiService.GetModelCategoriesAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading model categories: {ex.Message}");
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }

    private void OpenAddDialog()
    {
        // TODO: Implement add category dialog
    }

    private void EditCategory(ModelCategory category)
    {
        // TODO: Implement edit category dialog
    }

    private void DeleteCategory(ModelCategory category)
    {
        // TODO: Implement delete category confirmation
    }
} 