@using MudBlazor
@using PaintingProjectsManagement.UI.Modules.Projects
@using PaintingProjectsManagement.Features.Projects
@using System.Diagnostics

@namespace PaintingProjectsManagement.UI.Modules.Projects.UI.Dialogs

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudText Typo="Typo.h6">Create Color Group</MudText>
            
            <MudTextField @bind-Value="name" 
                         Label="Name" 
                         Variant="Variant.Outlined"
                         Required="true"
                         HelperText="Enter a name for this color group" />
            
            <MudText Typo="Typo.subtitle2">Select Zones</MudText>
            <MudText Typo="Typo.caption" Color="Color.Secondary">
                Select at least one zone (Highlights, Midtones, Shadows) for this color group.
            </MudText>
            
            <MudStack Spacing="2">
                <MudCheckBox T="bool" @bind-Value="isHighlightSelected" 
                            Label="Highlights" />
                <MudCheckBox T="bool" @bind-Value="isMidtoneSelected"
                            Label="Midtones" />
                <MudCheckBox T="bool" @bind-Value="isShadowSelected"
                            Label="Shadows" />
            </MudStack>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Submit" 
                  Color="Color.Primary" 
                  Size="Size.Medium" 
                  Variant="Variant.Filled"
                  Disabled="!CanSubmit">Create</MudButton>
        <MudButton OnClick="Cancel" 
                  Size="Size.Medium">Cancel</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter] public Guid ProjectId { get; set; }

    [CascadingParameter] public MudBlazor.IMudDialogInstance? MudDialog { get; set; }
    [Inject] public IProjectsService ProjectsService { get; set; } = default!;
    [Inject] public ISnackbar Snackbar { get; set; } = default!;

    private string name = string.Empty;
    private bool isHighlightSelected = false;
    private bool isMidtoneSelected = true;
    private bool isShadowSelected = false;

    private bool CanSubmit => !string.IsNullOrWhiteSpace(name) && (isHighlightSelected || isMidtoneSelected || isShadowSelected);

    private async Task Submit()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(name))
            {
                Snackbar.Add("Please enter a name", Severity.Warning);
                return;
            }

            var zones = new List<ColorZone>();
            if (isHighlightSelected) zones.Add(ColorZone.Highlight);
            if (isMidtoneSelected) zones.Add(ColorZone.Midtone);
            if (isShadowSelected) zones.Add(ColorZone.Shadow);

            if (zones.Count == 0)
            {
                Snackbar.Add("Please select at least one zone", Severity.Warning);
                return;
            }

            var request = new CreateColorGroupRequest
            {
                ProjectId = ProjectId,
                Name = name,
                Zones = zones.ToArray()
            };

            await ProjectsService.CreateColorGroupAsync(request, default);
            Snackbar.Add("Color group created successfully", Severity.Success);
            MudDialog?.Close(DialogResult.Ok(true));
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error creating color group: {ex.Message}", Severity.Error);
        }
    }
    
    private void Cancel()
    {
        MudDialog?.Cancel();
    }
}
