@page "/inventory/catalog"
@using MudBlazor
@using PaintingProjectsManagement.UI.Modules.Inventory
@using PaintingProjectsManagement.UI.Modules.Shared

<PageTitle>Catalog</PageTitle>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h5" Class="mb-4">Catalog</MudText>

    @if (_loading)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-4" />
    }
    else if (_catalog?.Brands?.Count > 0 == true)
    {
        <MudExpansionPanels Class="mt-4">
            @foreach (var brand in _catalog.Brands)
            {
                <MudExpansionPanel Key="@brand.Id">
                    <TitleContent>
                        <MudText Typo="Typo.h6">@brand.Name</MudText>
                    </TitleContent>
                    <ChildContent>
                        @if (brand.Lines?.Count > 0 == true)
                        {
                            <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
                                @foreach (var line in brand.Lines)
                                {
                                    <MudTabPanel Text="@line.Name" Key="@line.Id">
                                        <MudGrid Spacing="3">
                                            @if (line.Paints?.Count > 0 == true)
                                            {
                                                @foreach (var paint in line.Paints)
                                                {
                                                    <MudItem xs="12" sm="6" md="4" lg="3">
                                                        <div class="d-flex flex-column align-center">
                                                            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: @paint.HexColor; border: 1px solid #ccc; box-shadow: 0 1px 3px rgba(0,0,0,0.2);" title="@paint.Name"></div>
                                                            <MudText Typo="Typo.caption" Class="mt-1 text-center" Style="max-width: 80px;">@paint.Name</MudText>
                                                        </div>
                                                    </MudItem>
                                                }
                                            }
                                            else
                                            {
                                                <MudItem xs="12"><MudText Typo="Typo.body2" Color="Color.Secondary">No paints in this line.</MudText></MudItem>
                                            }
                                        </MudGrid>
                                    </MudTabPanel>
                                }
                            </MudTabs>
                        }
                        else
                        {
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No paint lines.</MudText>
                        }
                    </ChildContent>
                </MudExpansionPanel>
            }
        </MudExpansionPanels>
    }
    else
    {
        <MudText Typo="Typo.body1" Color="Color.Secondary">No brands in catalog.</MudText>
    }
</MudPaper>

@code {
    [Inject] public IInventoryService InventoryService { get; set; } = default!;

    private GetCatalogResponse? _catalog;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadAsync();
    }

    private async Task LoadAsync()
    {
        _loading = true;
        try
        {
            _catalog = await InventoryService.GetCatalogAsync(default);
        }
        finally
        {
            _loading = false;
        }
    }
}
