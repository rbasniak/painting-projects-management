@using MudBlazor
@using PaintingProjectsManagement.Features.Projects.UI
@using PaintingProjectsManagement.Features.Materials

@namespace PaintingProjectsManagement.UI.Modules.Projects.UI.Dialogs

<MudDialog>
    <DialogContent>
        <MudContainer MaxWidth="MaxWidth.Large" Class="pa-0">
            <MudGrid>
                <!-- Electricity Cost -->
                <MudItem xs="12" md="6">
                    <MudCard Elevation="3" Class="h-100">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6" Color="Color.Primary">Electricity</MudText>
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MudIcon Icon="@Icons.Material.Filled.ElectricBolt" Color="Color.Warning" />
                            </CardHeaderActions>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudList T="string" Dense="true">
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText>Consumption:</MudText>
                                        <MudText>@Model.Electricity.PrinterConsumptionInKWh.ToString("N2") kWh</MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText>Printing Time:</MudText>
                                        <MudText>@Model.Electricity.TotalPrintingTimeInHours.ToString("N2") hours</MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText>Cost / kWh:</MudText>
                                        <MudText>@Model.Electricity.CostPerKWh</MudText>
                                    </div>
                                </MudListItem>
                                <MudDivider Class="my-2" />
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText Typo="Typo.subtitle1"><b>Total:</b></MudText>
                                        <MudText Typo="Typo.subtitle1" Color="Color.Success"><b>@Model.Electricity.TotalCost</b></MudText>
                                    </div>
                                </MudListItem>
                            </MudList>
                        </MudCardContent>
                    </MudCard>
                </MudItem>

                <!-- Labor Cost -->
                <MudItem xs="12" md="6">
                    <MudCard Elevation="3" Class="h-100">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6" Color="Color.Primary">Labor</MudText>
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MudIcon Icon="@Icons.Material.Filled.Engineering" Color="Color.Info" />
                            </CardHeaderActions>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudList T="string" Dense="true">
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText>Spent Hours:</MudText>
                                        <MudText>@Model.Labor.SpentHours.ToString("N2") hours</MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText>Cost / Hour:</MudText>
                                        <MudText>@Model.Labor.CostPerHour</MudText>
                                    </div>
                                </MudListItem>
                                <MudDivider Class="my-2" />
                                <MudListItem>
                                    <div class="d-flex justify-space-between">
                                        <MudText Typo="Typo.subtitle1"><b>Total:</b></MudText>
                                        <MudText Typo="Typo.subtitle1" Color="Color.Success"><b>@Model.Labor.TotalCost</b></MudText>
                                    </div>
                                </MudListItem>
                            </MudList>
                        </MudCardContent>
                    </MudCard>
                </MudItem>

                <!-- Materials Cost -->
                <MudItem xs="12">
                    <MudCard Elevation="3">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6" Color="Color.Primary">Materials</MudText>
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MudIcon Icon="@Icons.Material.Filled.Inventory2" Color="Color.Secondary" />
                            </CardHeaderActions>
                        </MudCardHeader>
                        <MudCardContent>
                            @if (Model.Materials != null && Model.Materials.Any())
                            {
                                <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
                                    @foreach (var category in Model.Materials)
                                    {
                                        <MudTabPanel Text="@category.Key">
                                            <MudTable Items="@category.Value" Dense="true" Hover="true" Striped="true" Elevation="0">
                                                <HeaderContent>
                                                    <MudTh>Description</MudTh>
                                                    <MudTh>Quantity</MudTh>
                                                    <MudTh>Cost / Unit</MudTh>
                                                    <MudTh>Total</MudTh>
                                                </HeaderContent>
                                                <RowTemplate Context="material">
                                                    <MudTd DataLabel="Description">@material.Description</MudTd>
                                                    <MudTd DataLabel="Quantity">@material.Quantity</MudTd>
                                                    <MudTd DataLabel="Cost / Unit">@material.CostPerUnit</MudTd>
                                                    <MudTd DataLabel="Total">@material.TotalCost</MudTd>
                                                </RowTemplate>
                                            </MudTable>
                                        </MudTabPanel>
                                    }
                                </MudTabs>
                            }
                            else
                            {
                                <MudAlert Severity="Severity.Info">No materials used.</MudAlert>
                            }
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Color="Color.Primary" Variant="Variant.Filled">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IMudDialogInstance MudDialog { get; set; }

    [Parameter] public ProjectCostBreakdown Model { get; set; } = new();

    private void Close() => MudDialog.Close(DialogResult.Ok(true));
}
